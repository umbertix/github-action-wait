name: Build & push services image

on: push

jobs:
  service-build-push:
    name: Build and Push (Test me boy)
    runs-on: ubuntu-20.04
    strategy:
      matrix:
       services: [test1, test2]

    steps:
      - run: sleep 1s


  build-and-push-completed:
    name: Build and Push completed
    runs-on: ubuntu-20.04
    needs: [service-build-push]

    steps:
      - name: Invoke workflow without inputs
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: E2E Tests on Ephemeral environment
          token: ${{ secrets.REPO_ACCESS_TOKEN }}

      - name: Finished building and Publishing
        run: echo "Conclusion step for all services image building and pushing. This is a dependency for E2E ephemeral test"
